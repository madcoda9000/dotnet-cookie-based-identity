\hypertarget{_admin_controller_8cs_source}{}\doxysection{Admin\+Controller.\+cs}
\label{_admin_controller_8cs_source}\index{/Users/sascha.heimann/Projects/dotnet-\/cookie-\/based-\/identity/DotNetIdentity/Controllers/AdminController.cs@{/Users/sascha.heimann/Projects/dotnet-\/cookie-\/based-\/identity/DotNetIdentity/Controllers/AdminController.cs}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00001}00001 \textcolor{keyword}{using }System.Security.Claims;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00002}00002 \textcolor{keyword}{using }\mbox{\hyperlink{namespace_dot_net_identity_1_1_models}{DotNetIdentity.Models}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00003}00003 \textcolor{keyword}{using }\mbox{\hyperlink{namespace_dot_net_identity_1_1_data}{DotNetIdentity.Data}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00004}00004 \textcolor{keyword}{using }\mbox{\hyperlink{namespace_dot_net_identity_1_1_models_1_1_identity}{DotNetIdentity.Models.Identity}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00005}00005 \textcolor{keyword}{using }\mbox{\hyperlink{namespace_dot_net_identity_1_1_models_1_1_view_models}{DotNetIdentity.Models.ViewModels}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00006}00006 \textcolor{keyword}{using }\mbox{\hyperlink{namespace_dot_net_identity_1_1_models_1_1_data_models}{DotNetIdentity.Models.DataModels}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00007}00007 \textcolor{keyword}{using }Mapster;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00008}00008 \textcolor{keyword}{using }Microsoft.AspNetCore.Authorization;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00009}00009 \textcolor{keyword}{using }Microsoft.AspNetCore.Identity;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00010}00010 \textcolor{keyword}{using }Microsoft.AspNetCore.Mvc;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00011}00011 \textcolor{keyword}{using }Microsoft.EntityFrameworkCore;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00012}00012 \textcolor{keyword}{using }Serilog;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00013}00013 \textcolor{keyword}{using }Serilog.Sinks.MariaDB;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00014}00014 \textcolor{keyword}{using }Serilog.Sinks.MariaDB.Extensions;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00015}00015 \textcolor{keyword}{using }DatatableJS.Data;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00016}00016 \textcolor{keyword}{using }Microsoft.Extensions.Localization;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00018}\mbox{\hyperlink{namespace_dot_net_identity}{00018}} \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_dot_net_identity_1_1_controllers}{DotNetIdentity.Controllers}}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00019}00019 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00023}00023     [Authorize(Roles = \textcolor{stringliteral}{"{}Admin"{}})]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00024}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller}{00024}}     \textcolor{keyword}{public} \textcolor{keyword}{class }\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller}{AdminController}} : Controller}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00025}00025     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00029}00029         \textcolor{keyword}{private} readonly UserManager<AppUser> \_userManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00033}00033         \textcolor{keyword}{private} readonly RoleManager<AppRole> \_roleManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00037}00037         \textcolor{keyword}{private} readonly SignInManager<AppUser> \_signInManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00041}00041         \textcolor{keyword}{private} readonly IConfiguration \_configuration;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00045}00045         \textcolor{keyword}{private} readonly ILogger<AdminController> \_logger;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00049}00049         \textcolor{keyword}{private} readonly \mbox{\hyperlink{class_dot_net_identity_1_1_data_1_1_app_db_context}{AppDbContext}} \_context;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00053}00053         \textcolor{keyword}{private} readonly IStringLocalizer<UserController> \_localizer;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00054}00054 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00065}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a01af9770fe99667e4e948e3c5322c7be}{00065}}         \textcolor{keyword}{public} \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a01af9770fe99667e4e948e3c5322c7be}{AdminController}}(IStringLocalizer<UserController> localizer, \mbox{\hyperlink{class_dot_net_identity_1_1_data_1_1_app_db_context}{AppDbContext}} db, ILogger<AdminController> log, IConfiguration conf, UserManager<AppUser> userManager, RoleManager<AppRole> roleManager, SignInManager<AppUser> signInManager)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00066}00066         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00067}00067             \_userManager = userManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00068}00068             \_roleManager = roleManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00069}00069             \_signInManager = signInManager;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00070}00070             \_configuration = conf;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00071}00071             \_logger = log;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00072}00072             \_context = db;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00073}00073             \_localizer = localizer;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00074}00074         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00080}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a5f4b2842f8473f14a5e10470d3bd1d5b}{00080}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a5f4b2842f8473f14a5e10470d3bd1d5b}{Index}}() => View();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00085}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a013444bd9f40b5a78e04c0c7a2463736}{00085}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a013444bd9f40b5a78e04c0c7a2463736}{SystemLogs}}() => View();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00090}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a56a981db0e34d5b95d97da053d59f90c}{00090}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a56a981db0e34d5b95d97da053d59f90c}{AuditLogs}}() => View();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00095}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a21e35248bf081cd805ef51cbeb87f729}{00095}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a21e35248bf081cd805ef51cbeb87f729}{ErrorLogs}}() => View();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00100}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a190d9931cae4a99e50d8f47730b8445e}{00100}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a190d9931cae4a99e50d8f47730b8445e}{Users}}() => View(await \_userManager.Users.ToListAsync());      }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00105}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a35b4e53a2140e145b65b14f83f490c1e}{00105}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a35b4e53a2140e145b65b14f83f490c1e}{Roles}}() => View(await \_roleManager.Roles.ToListAsync());}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00112}00112         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00113}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a33a0ae1d862e6fc8fe837379f1e71871}{00113}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a33a0ae1d862e6fc8fe837379f1e71871}{GetErrorLogs}}(DataRequest request)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00114}00114         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00115}00115             DataResult<AppLogs> result = \_context.AppLogs!.Where(l=>l.Message.ToLower().StartsWith(\textcolor{stringliteral}{"{}audit"{}})==\textcolor{keyword}{false} \&\& Convert.ToInt32(l.Level) == 4).ToDataResult(request);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00116}00116             \textcolor{keywordflow}{return} Json(result);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00117}00117         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00124}00124         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00125}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ae837cd1bca6ffa486e8ef1d124be8c45}{00125}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ae837cd1bca6ffa486e8ef1d124be8c45}{GetAppLogs}}(DataRequest request)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00126}00126         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00127}00127             DataResult<AppLogs> result = \_context.AppLogs!.Where(l=>l.Message.ToLower().StartsWith(\textcolor{stringliteral}{"{}audit"{}})==\textcolor{keyword}{false} \&\& Convert.ToInt32(l.Level) < 4).ToDataResult(request);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00128}00128             \textcolor{keywordflow}{return} Json(result);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00129}00129         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00130}00130 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00136}00136         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00137}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a765780fbe678b84fb1532c873f761015}{00137}}         \textcolor{keyword}{public} IActionResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a765780fbe678b84fb1532c873f761015}{GetAuditLogs}}(DataRequest request)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00138}00138         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00139}00139             DataResult<AppLogs> result = \_context.AppLogs!.Where(l=>l.Message.ToLower().StartsWith(\textcolor{stringliteral}{"{}audit"{}})==\textcolor{keyword}{true}).ToDataResult(request);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00140}00140             \textcolor{keywordflow}{return} Json(result);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00141}00141         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00148}00148         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00149}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ab36c5deb1c4f3f99e316543f66b40b58}{00149}}         \textcolor{keyword}{public} JsonResult \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ab36c5deb1c4f3f99e316543f66b40b58}{GetUsers}}(DataRequest request) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00150}00150             DataResult<AppUser> result = \_userManager.Users.ToDataResult(request);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00151}00151             \textcolor{keywordflow}{return} Json(result);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00152}00152         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00153}00153 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00158}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_adaca6a26e3d091e4670aa37d0aa26095}{00158}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_adaca6a26e3d091e4670aa37d0aa26095}{NewUser}}() \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00159}00159             var mod = \textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model}{NewUserModel}}();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00160}00160             mod.Roles = await \_roleManager.Roles.Select(s => \textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_assign_role_view_model}{AssignRoleViewModel}}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00161}00161             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00162}00162                 RoleId = s.Id,}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00163}00163                 RoleName = s.Name,}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00164}00164                 IsAssigned = \textcolor{keyword}{false}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00165}00165             \}).ToListAsync();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00166}00166 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00167}00167             \textcolor{keywordflow}{return} View(mod);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00168}00168         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00175}00175         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00176}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a64bc568ac775c29e358c37f1b6eb9a6f}{00176}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a64bc568ac775c29e358c37f1b6eb9a6f}{NewUser}}(\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model}{NewUserModel}} viewModel)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00177}00177         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00178}00178             \textcolor{keywordflow}{if} (ModelState.IsValid)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00179}00179             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00180}00180                 var user = \textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_identity_1_1_app_user}{AppUser}}();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00181}00181                 user.IsEnabled = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00182}00182                 user.IsMfaForce = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a386700c6d1016a119610b19e33ebc07c}{IsMfaForce}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00183}00183                 user.IsLdapLogin = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_ac59fa961213dce0d9bad6383e15a2e98}{IsLdapLogin}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00184}00184                 user.FirstName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a61504666821f8dc6d9d33b0a4cc77b3c}{FirstName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00185}00185                 user.LastName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_aceaf9427b3dabdece9e7ce7feef994e8}{LastName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00186}00186                 user.Email = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a4efc9be88e208cf5c71d8e09ffbdbacf}{Email}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00187}00187                 user.EmailConfirmed = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00188}00188                 user.Gender = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a7ee12bb071a0973e4648e73d348a1d90}{Gender}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00189}00189                 user.Department = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a8f931f5e280c44a9fd20243fa58e4a67}{Department}}.ToString();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00190}00190                 user.UserName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a30f192b2fd398ca04a894b745ebc311d}{UserName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00192}00192                 var result = await \_userManager.CreateAsync(user, viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a9a0dfca231dffeaf800f7b3ef3cfeb59}{Password}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00193}00193                 \textcolor{keywordflow}{if} (result.Succeeded)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00194}00194                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00195}00195                     \textcolor{comment}{// roles}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00196}00196                     \textcolor{keywordflow}{foreach} (var item \textcolor{keywordflow}{in} viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model_a5145932ec19e08d2424a891907457bd4}{Roles}})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00197}00197                     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00198}00198                         \textcolor{keywordflow}{if} (item.IsAssigned)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00199}00199                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00200}00200                             await \_userManager.AddToRoleAsync(user, item.RoleName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00201}00201                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00202}00202                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00203}00203                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00204}00204                             await \_userManager.RemoveFromRoleAsync(user, item.RoleName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00205}00205                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00206}00206                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00207}00207                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00208}00208 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00209}00209                 var createdUser = await \_userManager.FindByNameAsync(user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00210}00210                 \textcolor{keywordflow}{if}(createdUser!=\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00211}00211                     var rls = await \_userManager.GetRolesAsync(createdUser);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00212}00212                     \textcolor{keywordflow}{if} (rls != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00213}00213                     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00214}00214                         var rlsComb = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00215}00215                         \textcolor{keywordflow}{if} (rls.Count() > 0 \&\& rls.Count() <= 1)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00216}00216                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00217}00217                             rlsComb = rls[0].ToString();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00218}00218                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00219}00219                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00220}00220                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00221}00221                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < rls.Count; i++)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00222}00222                             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00223}00223                                 \textcolor{keywordflow}{if} (i + 1 != rls.Count) \{ rlsComb += rls[i] + \textcolor{stringliteral}{"{},"{}}; \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00224}00224                                 \textcolor{keywordflow}{else} \{ rlsComb += rls[i]; \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00225}00225                             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00226}00226                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00227}00227                         \textcolor{keywordflow}{if} (rlsComb.Length > 0)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00228}00228                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00229}00229                             createdUser.RolesCombined = rlsComb;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00230}00230                             await \_userManager.UpdateAsync(createdUser);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00231}00231                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00232}00232                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00233}00233                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00234}00234 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00235}00235                 ViewData[\textcolor{stringliteral}{"{}message"{}}] = \_localizer[\textcolor{stringliteral}{"{}1"{}}];}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00236}00236                 \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} created new user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00237}00237             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00238}00238             \textcolor{keywordflow}{return} View(\textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_new_user_model}{NewUserModel}}());}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00239}00239         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00246}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a9da4db41821b95a045487b957546ad4e}{00246}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a9da4db41821b95a045487b957546ad4e}{UpsertRole}}(\textcolor{keywordtype}{string}? \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00247}00247         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00248}00248             \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00249}00249             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00250}00250                 var role = await \_roleManager.FindByIdAsync(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00251}00251                 \textcolor{keywordflow}{return} View(role.Adapt<\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model}{UpsertRoleViewModel}}>());}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00252}00252             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00253}00253             }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00254}00254             \textcolor{keywordflow}{return} View(\textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model}{UpsertRoleViewModel}}());}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00255}00255         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00256}00256 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00262}00262         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00263}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a868434f4412ed75643c1e09b3772896e}{00263}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a868434f4412ed75643c1e09b3772896e}{DisableUser}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00264}00264             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00265}00265             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00266}00266                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00267}00267             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00268}00268             user.IsEnabled = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00269}00269             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00270}00270             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} disabled user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00271}00271             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00272}00272         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00273}00273 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00279}00279         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00280}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_acafca207dc626b8405c100dae372339e}{00280}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_acafca207dc626b8405c100dae372339e}{EnableUser}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00281}00281             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00282}00282             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00283}00283                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00284}00284             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00285}00285             user.IsEnabled = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00286}00286             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00287}00287             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} enabled user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00288}00288             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00289}00289         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00290}00290 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00296}00296         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00297}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a968549db1c46319c67839ab9a29db384}{00297}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a968549db1c46319c67839ab9a29db384}{EnableLdapLogin}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00298}00298             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00299}00299             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00300}00300                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00301}00301             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00302}00302             user.IsLdapLogin = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00303}00303             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00304}00304             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} enabled LDAP login for user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00305}00305             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00306}00306         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00313}00313         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00314}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_adec1057b9574f3fdb012e75c5c425409}{00314}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_adec1057b9574f3fdb012e75c5c425409}{DisableLdapLogin}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00315}00315             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00316}00316             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00317}00317                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00318}00318             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00319}00319             user.IsLdapLogin = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00320}00320             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00321}00321             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} disabled ldap login for user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00322}00322             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00323}00323         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00324}00324 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00330}00330         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00331}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a717d7b1ad7653611b7cd5b507bdedeb1}{00331}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a717d7b1ad7653611b7cd5b507bdedeb1}{EnableMfaForce}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00332}00332             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00333}00333             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00334}00334                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00335}00335             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00336}00336             user.IsMfaForce = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00337}00337             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00338}00338             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} enabled mfa enforce for user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00339}00339             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00340}00340         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00341}00341 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00347}00347         [HttpGet]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00348}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a17c792f0c3526066cfca21d73fabd569}{00348}}         \textcolor{keyword}{public} async Task<ActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a17c792f0c3526066cfca21d73fabd569}{DisableMfaForce}}(\textcolor{keywordtype}{string} UserId) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00349}00349             var user = await \_userManager.FindByIdAsync(UserId);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00350}00350             \textcolor{keywordflow}{if}(user==\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00351}00351                 \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{ success = \textcolor{keyword}{false} \});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00352}00352             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00353}00353             user.IsMfaForce = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00354}00354             await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00355}00355             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} disabled mfa enforce for user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00356}00356             \textcolor{keywordflow}{return} Json(\textcolor{keyword}{new} \{success = \textcolor{keyword}{true}\});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00357}00357         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00358}00358 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00364}00364         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00365}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a94f52c0e032a774cc8d1590d6688d101}{00365}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a94f52c0e032a774cc8d1590d6688d101}{UpsertRole}}(\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model}{UpsertRoleViewModel}} viewModel)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00366}00366         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00367}00367             \textcolor{keywordflow}{if} (ModelState.IsValid)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00368}00368             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00369}00369                 var isUpdate = viewModel.Id != \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00371}00371                 var role = isUpdate ? await \_roleManager.FindByIdAsync(viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a65cbdc82687f49cd26032a402a8f7741}{Id}}) : \textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_identity_1_1_app_role}{AppRole}}() \{ Name = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a1372e8f0ae5f5c399d5732a80850a31f}{Name}}, CreatedOn = DateTime.Now \};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00372}00372 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00373}00373                 \textcolor{keywordflow}{if} (isUpdate)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00374}00374                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00375}00375                     role.Name = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a1372e8f0ae5f5c399d5732a80850a31f}{Name}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00376}00376                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00378}00378                 var result = isUpdate ? await \_roleManager.UpdateAsync(role) : await \_roleManager.CreateAsync(role);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00379}00379                 \textcolor{keywordflow}{if} (result.Succeeded)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00380}00380                 \{                    }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00381}00381                     \textcolor{keywordflow}{if}(isUpdate) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00382}00382                         \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} changed name of "{}} + viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a65cbdc82687f49cd26032a402a8f7741}{Id}} + \textcolor{stringliteral}{"{} to "{}} + viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a1372e8f0ae5f5c399d5732a80850a31f}{Name}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00383}00383                     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00384}00384                         \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} created role "{}} + viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_upsert_role_view_model_a1372e8f0ae5f5c399d5732a80850a31f}{Name}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00385}00385                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00386}00386                     \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Roles"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00387}00387                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00388}00388                 result.Errors.ToList().ForEach(f => ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, f.Description));}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00389}00389                 result.Errors.ToList().ForEach(f => TempData[\textcolor{stringliteral}{"{}Error"{}}] += f.Description);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00390}00390             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00391}00391             }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00392}00392             \textcolor{comment}{//return View(viewModel);}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00393}00393             \textcolor{comment}{//return View("{}Roles"{}, await \_roleManager.Roles.ToListAsync());}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00394}00394             \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Roles"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00395}00395         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00396}00396 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00402}00402         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00403}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ab1c7981b89ddff2100c7bd201cf45766}{00403}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_ab1c7981b89ddff2100c7bd201cf45766}{DeleteUser}}(\textcolor{keywordtype}{string} \textcolor{keywordtype}{id}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00404}00404             var user = await \_userManager.FindByIdAsync(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00405}00405             \textcolor{keywordflow}{if}(user!=\textcolor{keyword}{null}) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00406}00406                 var result = await \_userManager.DeleteAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00407}00407                 \textcolor{keywordflow}{if}(!result.Succeeded) \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00408}00408                     result.Errors.ToList().ForEach(f => ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, f.Description));}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00409}00409                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00410}00410             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00411}00411                 ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, \_localizer[\textcolor{stringliteral}{"{}2"{}}]);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00412}00412             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00413}00413             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} deleted user "{}} + \textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00414}00414             \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Users"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00415}00415         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00416}00416 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00422}00422         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00423}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_aa570b5cef28f1c3dda939971a2bc0f44}{00423}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_aa570b5cef28f1c3dda939971a2bc0f44}{DeleteRole}}(\textcolor{keywordtype}{string} \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00424}00424         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00425}00425             var role = await \_roleManager.FindByIdAsync(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00426}00426             \textcolor{keywordflow}{if} (role != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00427}00427             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00428}00428                 var result = await \_roleManager.DeleteAsync(role);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00429}00429                 \textcolor{keywordflow}{if} (!result.Succeeded)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00430}00430                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00431}00431                     result.Errors.ToList().ForEach(f => ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, f.Description));}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00432}00432                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00433}00433             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00434}00434             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00435}00435             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00436}00436                 ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, \_localizer[\textcolor{stringliteral}{"{}3"{}}]);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00437}00437             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00438}00438             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} deleted role "{}} + \textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00439}00439             \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Roles"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00440}00440         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00441}00441 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00447}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_afe437521759b5fd93d0bb4bbbddfce15}{00447}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_afe437521759b5fd93d0bb4bbbddfce15}{EditUser}}(\textcolor{keywordtype}{string} \textcolor{keywordtype}{id})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00448}00448         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00449}00449             var user = await \_userManager.FindByIdAsync(\textcolor{keywordtype}{id});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00450}00450             \textcolor{keywordflow}{if} (user == \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00451}00451             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00452}00452                 \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Users"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00453}00453             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00454}00454             var viewModel = user.Adapt<\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model}{EditUserViewModel}}>();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00455}00455 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00456}00456             var userRoles = await \_userManager.GetRolesAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00457}00457             viewModel.Roles = await \_roleManager.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_afb203b91eacf83ed47dd236a546de57e}{Roles}}.Select(s => \textcolor{keyword}{new} \mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_assign_role_view_model}{AssignRoleViewModel}}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00458}00458             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00459}00459                 RoleId = s.Id,}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00460}00460                 RoleName = s.Name,}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00461}00461                 IsAssigned = userRoles.Any(a => a == s.Name)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00462}00462             \}).ToListAsync();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00463}00463 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00464}00464             var userClaims = await \_userManager.GetClaimsAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00465}00465             var departmentClaim = userClaims.FirstOrDefault(f => f.Type == \textcolor{stringliteral}{"{}Department"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00466}00466             \textcolor{keywordflow}{if} (departmentClaim != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00467}00467             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00468}00468                 viewModel.Department = Enum.Parse<\mbox{\hyperlink{namespace_dot_net_identity_1_1_models_a0c2566102c085d8fb8859ba2cc48f7f5}{Department}}>(departmentClaim.Value);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00469}00469             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00470}00470             }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00471}00471             \textcolor{keywordflow}{return} View(viewModel);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00472}00472         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00473}00473 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00479}00479         [HttpPost]}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00480}\mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a5af2b4d9b15eee2ef5d28600aacc6ace}{00480}}         \textcolor{keyword}{public} async Task<IActionResult> \mbox{\hyperlink{class_dot_net_identity_1_1_controllers_1_1_admin_controller_a5af2b4d9b15eee2ef5d28600aacc6ace}{EditUser}}(\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model}{EditUserViewModel}} viewModel)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00481}00481         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00482}00482             \textcolor{keywordflow}{if} (ModelState.IsValid)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00483}00483             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00484}00484                 var user = await \_userManager.FindByIdAsync(viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a44d3f139f58eb560e41f2c228c00b18b}{Id}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00485}00485                 \textcolor{keywordflow}{if} (user != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00486}00486                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00487}00487                     \textcolor{keywordflow}{if} (user.PhoneNumber != viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a0766c2ef3010d290973d1981e4afcbde}{PhoneNumber}} \&\& \_userManager.Users.Any(a => a.PhoneNumber == viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a0766c2ef3010d290973d1981e4afcbde}{PhoneNumber}}))}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00488}00488                     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00489}00489                         ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, \_localizer[\textcolor{stringliteral}{"{}4"{}}]);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00490}00490                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00491}00491                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00492}00492                     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00493}00493                         user.FirstName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a1ce72dd9e8f4eb8ce20e37fb247e486d}{FirstName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00494}00494                         user.LastName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a4c0545e46724baab75383047c6003a4a}{LastName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00495}00495                         user.UserName = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_ad8cb8b8701e79ab226979d760e38ac04}{UserName}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00496}00496                         user.Email = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a93cb61f5c47ffe5a6271b25151464161}{Email}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00497}00497                         user.PhoneNumber = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_a0766c2ef3010d290973d1981e4afcbde}{PhoneNumber}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00498}00498                         user.Gender = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_ab987b2e7b390141dd86a7ba4ca2c93fd}{Gender}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00499}00499                         user.Department = viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_ac769e7bcadc47007228186b011ed0512}{Department}}.ToString();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00501}00501                         var result = await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00502}00502                         \textcolor{keywordflow}{if} (result.Succeeded)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00503}00503                         \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00504}00504                             \textcolor{comment}{// Roles}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00505}00505                             \textcolor{keywordflow}{foreach} (var item \textcolor{keywordflow}{in} viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_afb203b91eacf83ed47dd236a546de57e}{Roles}})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00506}00506                             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00507}00507                                 \textcolor{keywordflow}{if} (item.IsAssigned)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00508}00508                                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00509}00509                                     await \_userManager.AddToRoleAsync(user, item.RoleName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00510}00510                                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00511}00511                                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00512}00512                                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00513}00513                                     await \_userManager.RemoveFromRoleAsync(user, item.RoleName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00514}00514                                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00515}00515                             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00516}00516 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00517}00517                             \textcolor{comment}{// roles combined}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00518}00518                             var rls = await \_userManager.GetRolesAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00519}00519                             \textcolor{keywordflow}{if} (rls != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00520}00520                             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00521}00521                                 var rlsComb = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00522}00522                                 \textcolor{keywordflow}{if} (rls.Count() > 0 \&\& rls.Count() <= 1)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00523}00523                                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00524}00524                                     rlsComb = rls[0].ToString();}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00525}00525                                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00526}00526                                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00527}00527                                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00528}00528                                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < rls.Count; i++)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00529}00529                                     \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00530}00530                                         \textcolor{keywordflow}{if} (i + 1 != rls.Count) \{ rlsComb += rls[i] + \textcolor{stringliteral}{"{},"{}}; \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00531}00531                                         \textcolor{keywordflow}{else} \{ rlsComb += rls[i]; \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00532}00532                                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00533}00533                                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00534}00534                                 \textcolor{keywordflow}{if} (rlsComb.Length > 0)}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00535}00535                                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00536}00536                                     user.RolesCombined = rlsComb;}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00537}00537                                     await \_userManager.UpdateAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00538}00538                                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00539}00539                             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00540}00540 }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00541}00541                             \textcolor{comment}{// Claims}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00542}00542                             var userClaims = await \_userManager.GetClaimsAsync(user);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00543}00543                             var departmentClaim = userClaims.FirstOrDefault(a => a.Type == \textcolor{stringliteral}{"{}Department"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00544}00544                             var claimsToAdd = \textcolor{keyword}{new} Claim(\textcolor{stringliteral}{"{}Department"{}}, Enum.GetName(viewModel.\mbox{\hyperlink{class_dot_net_identity_1_1_models_1_1_view_models_1_1_edit_user_view_model_ac769e7bcadc47007228186b011ed0512}{Department}})!);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00545}00545                             \textcolor{keywordflow}{if} (departmentClaim != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00546}00546                             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00547}00547                                 await \_userManager.ReplaceClaimAsync(user, departmentClaim, claimsToAdd);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00548}00548                             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00549}00549                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00550}00550                             \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00551}00551                                 await \_userManager.AddClaimAsync(user, claimsToAdd);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00552}00552                             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00553}00553                             \_logger.LogInformation(\textcolor{stringliteral}{"{}AUDIT: "{}} + User.Identity!.Name + \textcolor{stringliteral}{"{} modified user "{}} + user.UserName);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00554}00554                             \textcolor{keywordflow}{return} RedirectToAction(\textcolor{stringliteral}{"{}Users"{}});}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00555}00555                         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00556}00556                         result.Errors.ToList().ForEach(f => ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, f.Description));}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00557}00557                     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00558}00558                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00559}00559                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00560}00560                 \{}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00561}00561                     ModelState.AddModelError(\textcolor{keywordtype}{string}.Empty, \_localizer[\textcolor{stringliteral}{"{}2"{}}]);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00562}00562                 \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00563}00563             \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00564}00564             }
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00565}00565             \textcolor{keywordflow}{return} View(viewModel);}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00566}00566         \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00567}00567     \}}
\DoxyCodeLine{\Hypertarget{_admin_controller_8cs_source_l00568}00568 \}}

\end{DoxyCode}
